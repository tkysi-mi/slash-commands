---
description: ユーザーストーリーとインタビューからタスク定義ドキュメントを作成し、目的・変更内容・受け入れ基準を明確化するワークフロー
auto_execution_mode: 1
---

# /b-001-CreateTaskDefinition

## 目的

- 新しいタスクの目的と範囲を明確化する。
- ユーザーストーリーから具体的な要件を抽出する。
- 変更内容（画面、データモデル、API など）を詳細に定義する。
- 受け入れ基準を事前に定義し、完了の判断基準を明確にする。
- 実装前に関係者間で認識を統一し、手戻りを防ぐ。

## 前提

- タスクディレクトリが既に作成されていること（`/b-000-CreateTaskDirectory` で作成済み）
- タスクディレクトリ形式: `docs/tasks/task000001-{スラッグ}/`
- タスクディレクトリ内に `a-definition.md` テンプレートが存在すること
- タスクの大まかな内容がユーザーから提示されること

## 手順

### 1. タスクディレクトリの確認

**質問1: タスクディレクトリの確認**
- 「タスクディレクトリが既に作成されていますか？」
- 作成されていない場合：
  - 「先に `/b-000-CreateTaskDirectory` を実行してタスクディレクトリを作成してください。」
- 作成済みの場合：
  - 「タスクディレクトリのパスを教えてください。」
  - 例: `docs/tasks/task000001-email-verification/`

### 2. タスクの目的の定義

#### 2.1. 解決する問題の特定

**質問3: 解決する問題**
- 「このタスクで解決する具体的な問題は何ですか？」
- 追加質問：
  - 「現在、どのような不便や問題がありますか？」
  - 「その問題はどのくらいの頻度で発生しますか？」
  - 「誰がその問題に困っていますか？（ユーザー、開発者、運用者など）」

**具体性の確保**:
- あいまいな表現を避ける
- 数値や頻度を含める
- Before/After が明確に想像できる表現

例：
- ❌ 「ユーザー登録が使いにくい」
- ✅ 「ユーザー登録時のメール認証フローがなく、不正なメールアドレスが月間約50件登録される」

#### 2.2. 提供する価値の明確化

**質問4: 提供する価値**
- 「このタスクが完了すると、誰にどのような価値を提供しますか？」
- 追加質問：
  - 「ユーザーにとってのメリットは何ですか？」
  - 「開発者や運用者にとってのメリットは何ですか？」
  - 「ビジネスへの影響は何ですか？（コスト削減、品質向上、売上増加など）」

**具体性の確保**:
- 測定可能な価値を含める
- ステークホルダー視点で記載

例：
- ❌ 「ユーザー体験が向上する」
- ✅ 「メール認証により、有効なメールアドレスのみ登録可能になり、通知配信の精度が95%以上に向上する。また、スパム登録が50%削減される」

### 3. ユーザーストーリーの定義

#### 3.1. ユーザーストーリーの抽出

**質問5: 主要なペルソナ**
- 「このタスクに関連する主要なペルソナ（役割）は誰ですか？」
- 例：新規ユーザー、既存ユーザー、管理者、システム管理者、開発者

#### 3.2. 各ペルソナのストーリー作成

各ペルソナについて、以下をヒアリング：

**質問6: ストーリーID**
- 自動採番：US-001, US-002...

**質問7: ユーザーストーリー**
- 「[ペルソナ]として、何がしたいですか？なぜそれが必要ですか？」
- フォーマット：「[役割]として、[目的]がしたい、なぜなら[理由]」

例：
- 「新規ユーザーとして、登録時にメール認証を受けたい、なぜなら自分のメールアドレスが正しく登録されたことを確認したいから」
- 「管理者として、認証済みユーザーのみに通知を送信したい、なぜなら配信エラーを減らしたいから」

**ベストプラクティス**:
- 1つのストーリーは1つの価値に焦点を当てる
- 技術的な詳細ではなくユーザー価値を記載
- 複数の役割がある場合は分けて記載

#### 3.3. ストーリー一覧の確認

- 「以下のユーザーストーリーで十分ですか？不足しているストーリーはありませんか？」
- ストーリー一覧を表示

### 4. 変更内容の定義

#### 4.1. 影響範囲の特定

**質問8: 変更が必要なカテゴリ**
- 「このタスクで変更が必要なカテゴリは何ですか？」

カテゴリ：
- 画面（UI/UX）
- データモデル（データベーススキーマ）
- API（エンドポイント、リクエスト/レスポンス）
- ビジネスロジック（サービス層、ドメインロジック）
- インフラ（環境変数、設定ファイル、外部サービス連携）
- その他

#### 4.2. 各カテゴリの詳細定義

各カテゴリについて、以下をヒアリング：

**画面（UI/UX）の変更**:

**質問9: 画面の変更内容**
- 「どの画面を変更しますか？新規作成しますか？」
- 具体的なファイル名またはコンポーネント名を確認
- 変更の種類：
  - 新規作成
  - 既存の変更（フィールド追加、レイアウト変更など）
  - 削除

例：
- 「RegisterForm.tsx にメールアドレス入力フィールド追加」
- 「EmailVerificationPage.tsx 新規作成」
- 「ログイン画面に「メール未認証」警告メッセージ追加」

**データモデルの変更**:

**質問10: データモデルの変更内容**
- 「データベーススキーマに変更が必要ですか？」
- 変更内容：
  - 新しいテーブルの追加
  - 既存テーブルへのカラム追加
  - インデックスの追加
  - 制約の追加
  - データ型の変更

例：
- 「User テーブルに `email_verified` (boolean), `verification_token` (string, nullable), `token_expires_at` (datetime, nullable) フィールド追加」
- 「`verification_token` にユニークインデックス追加」

**APIの変更**:

**質問11: APIの変更内容**
- 「APIエンドポイントの追加や変更が必要ですか？」
- エンドポイントごとに：
  - HTTPメソッド（GET, POST, PUT, PATCH, DELETE）
  - パス（例：`/api/auth/send-verification`）
  - リクエスト内容（簡潔に）
  - レスポンス内容（簡潔に）

例：
- 「POST /api/auth/send-verification - メール送信、リクエスト: { email }, レスポンス: { success: true }」
- 「POST /api/auth/verify-email - メール認証、リクエスト: { token }, レスポンス: { success: true, user }」

**その他の変更**:

**質問12: その他の変更**
- 「その他、変更が必要なものはありますか？」
- 例：
  - 環境変数（API キー、設定値）
  - 外部サービスの設定（SendGrid、AWS SES など）
  - 設定ファイル（config.json など）
  - ドキュメント更新

### 5. 受け入れ基準の定義

#### 5.1. 正常系の受け入れ基準

**質問13: 正常系の動作**
- 「正常に動作する場合、何が起こるべきですか？」

例：
- 「ユーザー登録時に認証メールが送信される」
- 「メール内のリンクをクリックするとメールアドレスが認証される」
- 「認証済みユーザーは全ての機能にアクセスできる」

#### 5.2. 異常系・エラーケースの受け入れ基準

**質問14: 異常系・エラーケース**
- 「エラーが発生する可能性がある状況は何ですか？その場合、どうあるべきですか？」

例：
- 「無効なトークンでアクセスした場合、適切なエラーメッセージが表示される」
- 「トークンの有効期限が切れた場合、再送信を促すメッセージが表示される」
- 「認証されていないユーザーは特定機能にアクセスできず、認証ページにリダイレクトされる」

#### 5.3. エッジケースの受け入れ基準

**質問15: エッジケース**
- 「特殊なケースや境界値はありますか？」

例：
- 「既に認証済みのユーザーが再度認証リンクをクリックした場合、「既に認証済みです」メッセージが表示される」
- 「同時に複数のメール送信リクエストがあった場合、レート制限が適用される」

#### 5.4. テスト・品質の受け入れ基準

**質問16: テスト要件**
- 「テストの要件はありますか？」

例：
- 「ユニットテストが全て通る」
- 「統合テストが全て通る」
- 「E2Eテストが全て通る」
- 「テストカバレッジが80%以上」

**質問17: パフォーマンス要件**
- 「パフォーマンス要件はありますか？」

例：
- 「メール送信は3秒以内に完了する」
- 「認証ページの表示は2秒以内」

**質問18: セキュリティ要件**
- 「セキュリティ要件はありますか？」

例：
- 「トークンは暗号学的に安全なランダム文字列（UUID v4）を使用」
- 「トークンは1回のみ使用可能」
- 「HTTPS通信のみ許可」

### 6. メモ・補足情報

**質問19: 補足情報**
- 「その他、補足情報はありますか？」

記載すべき内容：
- 技術的な制約や前提条件
- 関連する Issue や PR のリンク
- 参考資料（仕様書、デザインモック、競合サービスなど）
- 既知の問題や懸念事項
- 将来的な拡張予定

例：
- 「関連 Issue: #123」
- 「参考デザイン: https://figma.com/file/...」
- 「注意: メール送信は非同期処理で実装する（ジョブキュー使用）」
- 「今後の拡張: SMS 認証も追加予定」

### 7. ドキュメント作成

- 収集した情報を基に、タスクディレクトリ内の `a-definition.md` を編集
- 例: `docs/tasks/task000001-email-verification/a-definition.md`

- テンプレートに従い、以下を記載：
  - **目的**（解決する問題、提供する価値）
  - **ユーザーストーリー一覧**（ストーリーID、ストーリー）
  - **変更内容一覧**（カテゴリ、変更内容）
  - **受け入れ基準**（正常系、異常系、エッジケース、テスト、パフォーマンス、セキュリティ）
  - **メモ**（補足情報）

- **HTMLコメントは削除せず残す**

### 8. レビューと確認

- 作成したドキュメントをユーザーに提示：
  - 「タスク定義ドキュメントが完成しました。内容を確認してください。」
  - 「目的は明確ですか？」
  - 「変更内容は網羅されていますか？」
  - 「受け入れ基準は具体的で測定可能ですか？」

### 9. 完成と次のステップ

- タスクディレクトリ内の `a-definition.md` が保存されたことを確認
- 例: `docs/tasks/task000001-email-verification/a-definition.md`

- 次のステップを提案：
  - 「タスク定義が完了しました。次はリサーチドキュメントを作成しますか？（`/b-002-CreateTaskResearch`）」

## 完了条件

- タスクディレクトリ内に `a-definition.md` が作成されている
- 例: `docs/tasks/task000001-{スラッグ}/a-definition.md`
- 以下のセクションがすべて記載されている：
  - 目的（解決する問題、提供する価値）
  - ユーザーストーリー一覧（最低1個以上）
  - 変更内容一覧（該当するカテゴリがすべて含まれている）
  - 受け入れ基準（正常系、異常系、テスト要件）
- 目的が具体的で測定可能である
- ユーザーストーリーが「[役割]として、[目的]がしたい、なぜなら[理由]」形式で記載されている
- 変更内容が具体的なファイル名やコンポーネント名を含んでいる
- 受け入れ基準が具体的で測定可能である
- ユーザーが内容を確認し、承認している

## エスカレーション

- タスクの目的が曖昧な場合：
  - 「タスクの目的が曖昧です。具体的な問題と解決後の状態を明確にしてください。」
  - 追加の質問で深掘り

- 変更内容が不明確な場合：
  - 「変更内容が抽象的すぎます。具体的なファイル名、コンポーネント名、カラム名を含めてください。」

- 受け入れ基準が曖昧な場合：
  - 「受け入れ基準が曖昧です。テスト可能な基準を定義してください。」
  - 例：「使いやすい」→「登録完了まで3クリック以内」

- ユーザーストーリーが技術的すぎる場合：
  - 「ユーザーストーリーが技術的すぎます。ユーザー視点の価値を記載してください。」
  - 例：「React Hook Form を使用したい」→「入力エラーを即座に確認したい」

- タスクのスコープが大きすぎる場合：
  - 「このタスクは範囲が広すぎます。複数のタスクに分割することを推奨します。」
  - 1タスクは1-5日で完了できる粒度が理想

- 受け入れ基準にセキュリティ要件が欠けている場合：
  - 「セキュリティに関する受け入れ基準が不足しています。以下を検討してください：」
    - 入力バリデーション
    - XSS、CSRF、SQL Injection 対策
    - 認証・認可
    - データの暗号化
