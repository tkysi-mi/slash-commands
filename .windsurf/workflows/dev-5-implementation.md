# /dev-5-implementation

## 目的

- 計画フェーズで作成したStoryファイルを起点に、開発作業を一貫した手順で遂行する。
- Claude-Flowのスキル群とBMADのDevエージェント手法を活用し、コンテキスト損失を防ぎながら高品質な成果物を提供する。

## 前提

- `/dev-2-planning`でPRD・アーキテクチャ・Storyファイルの下準備が完了していることが望ましいが、未実施の場合は手順1で`code_search`/`read_file`を用いて必要情報を自力収集する。
- 対象リポジトリのセットアップが済み、ローカル環境でテスト・ビルドが実行可能である。
- チームのコーディング規約、テスト戦略、ブランチ戦略（例: trunk-based）が共有済みである。
- 外部ワークフローを利用しない場合でも、Git操作やテスト実行を手動で行えるよう権限・CLIが整っている。

## 手順

### プラン作成（Create Plans）

1. Storyインテークと整合性チェック

   - Storyファイルの目的・完了条件・依存関係を確認し、齟齬があればScrum Masterへ即時エスカレーションする。
   - Storyが存在しない場合は新規作成し、依頼内容・成功指標・制約を箇条書きで記録する。
   - PRD/設計/リスクログなどの参照資料を`code_search`/`read_file`で取得し、欠落があれば依頼元に提供を依頼する。
   - 依頼内容が断片的な場合は`update_plan`でサブタスク化し、情報補完ポイントを洗い出す。

2. 実装ポリシーと成功条件の確定

   - チームのコーディング規約・テスト戦略・リリース条件を確認し、Storyにリンクを追加する。
   - 既知のリスクや非機能要件をStoryへ転記し、解決方針が未決のものはTODOとして管理する。

### システム設計（System Design）

1. 実装ガイドラインの更新

   - Claude Code/Claude-Flowの設定を読み込み、必要なスキル（例: pair-programming、agentdb-vector-search）を有効化する。設定ファイルが無い場合はCLIコマンドを記録して共有する。
   - テストランナーやビルドスクリプトが未整備なら最低限の実行コマンドをREADMEまたはStoryに追加する。
   - Secretsや環境変数が未設定の場合は暫定値を定義し、依頼元と共有する。

2. ブランチおよびアーキテクチャ整合

   - Story IDを含む命名規則で作業ブランチを作成する。Gitフローが未定義なら`main`から派生し、命名ルールをStoryに記載する。
   - 変更影響範囲を整理し、Architectまたはレビュー担当と事前に設計合意を取る。必要に応じて設計ドキュメントを更新する。

### タスク実行（Task Execution）

1. 実装ループ

   - 「IF サブタスク化が必要 THEN 小タスクごとにコミット粒度を定義する」。
   - 「FOR EACH サブタスク」について、仕様確認 → 設計案作成 → 実装 → ローカルテスト → 差分セルフレビューの順で進める。
   - 自動生成コードを利用する場合は人間による検証とコメント整備を必須とする。
   - 重大な設計変更が必要になった場合は、早期にScrum Master/Architectへ共有しStoryを更新する。

2. 品質保証と証跡収集

   - 単体・結合テストを実行し、`run_command`で得たログやスクリーンショットをStoryに添付する。
   - 静的解析・リンター・フォーマッタを実行し、結果をStoryに記録する。自動化が無い場合は手動手順を追記する。
   - CIエラーや重大な失敗が発生した場合は原因・暫定対応・再発防止策をStoryへ記録し、`update_plan`でリトライ手順を管理する。

3. コミットとPR作成

   - コミットメッセージはStory IDと意図を含める。Storyが無い場合は課題番号やチケットIDを利用する。
   - PRテンプレートを利用し、変更概要/テスト結果/影響範囲/エスカレーション事項/追加ワークフロー呼び出し要否を明記する。テンプレートが無い場合はStoryのチェックリストを転記する。
   - Draft状態でレビューアサインし、早期フィードバックを受ける。
   - GitOpsや自動デプロイが存在する場合は、必要なラベル・承認条件・マージ要件をStoryに記録する。

4. Story更新とハンドオーバー

   - 実装内容、テストログ、既知課題、フォローアップタスクをStoryへ追記する。Storyが無い場合は新規作成し、変更点を箇条書きで残す。
   - 次ステップとして実行すべきワークフロー（例: `/dev-7-swarm-qa`、リリース準備）を明記する。後続ワークフローが無い場合は手動対応のチェックリストと責任者を記載する。
   - 依頼元へ進捗を共有し、承認または追加作業の指示を待つ。共有チャネルが未定義ならREADMEの連絡手段を確認する。
   - ハンドオーバー後のフォローアップ方法（例: Standupでの報告、チケット更新）を明記する。

## 完了条件

- Storyファイルに実装内容とテスト結果が反映され、レビューに必要なコンテキストが揃っている。
- PRが作成され、必要なラベル・レビューアが設定済みである。
- 追加ワークフロー（QA/リリースなど）の起動条件がStoryに記述され、次工程へ引き渡し可能な状態になっている。

## エスカレーション

- Story内容と実装の整合が取れない場合は、Scrum MasterまたはArchitectへ即時相談する。
- 重大な技術的制約・セキュリティリスク・プロダクト方針への影響が判明した場合は、プロダクトオーナーへエスカレーションする。
