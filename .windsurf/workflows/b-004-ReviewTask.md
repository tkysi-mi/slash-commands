---
description: タスクドキュメント間の一貫性をチェックし、定義・リサーチ・実装計画の整合性を検証するレビューワークフロー
auto_execution_mode: 1
---

# /b-004-ReviewTask

## 目的

- タスクレベルの3つのドキュメント（a-definition.md, b-research.md, c-implementation.md）間の一貫性を体系的にチェックする。
- ドキュメント間の不整合、漏れ、矛盾を検出し、修正提案を提供する。
- 実装計画がタスク定義とリサーチ結果を正しく反映しているか検証する。
- タスクの実現可能性と完全性を確認し、実装前に問題を発見する。
- レビュー結果レポートを作成し、修正すべき項目を優先度付きでリストアップする。

## 前提

- タスクディレクトリが作成されていること（`/b-000-CreateTaskDirectory` 実施済み）
- 以下の3つのドキュメントが作成されていること：
  - `docs/tasks/task{id}-{スラッグ}/a-definition.md` （`/b-001` で作成）
  - `docs/tasks/task{id}-{スラッグ}/b-research.md` （`/b-002` で作成）
  - `docs/tasks/task{id}-{スラッグ}/c-implementation.md` （`/b-003` で作成）
- Git リポジトリが初期化されていること

## 手順

### 1. タスクディレクトリの特定

**タスクIDの確認**:
- レビュー対象のタスクIDを確認（例: task000001-email-verification）
- タスクディレクトリパス: `docs/tasks/task{id}-{スラッグ}/`

### 2. ドキュメント存在確認

- 以下のドキュメントを読み込む：
  - `@docs/tasks/task{id}-{スラッグ}/a-definition.md`
  - `@docs/tasks/task{id}-{スラッグ}/b-research.md`
  - `@docs/tasks/task{id}-{スラッグ}/c-implementation.md`

- 不足しているドキュメントがある場合：
  - 「以下のドキュメントが見つかりません：[リスト]」
  - 「先に該当するワークフローを実行してください。」
  - レビューは実行可能な範囲で継続

### 3. レビュー項目の初期化

- レビュー結果を記録するための構造を準備：
  ```
  レビュー結果:
  - OK: 問題なし
  - Warning: 要確認（重大ではないが改善推奨）
  - Error: 修正必須（不整合や重大な漏れ）
  ```

### 4. 一貫性チェック1: タスク定義 ↔ 実装計画（変更内容のカバレッジ）

#### 4.1. 変更内容と実装ステップのマッピング

- タスク定義（a-definition.md）の「変更内容一覧」を抽出：
  - 画面（追加・変更する画面やコンポーネント）
  - データモデル（テーブル、カラムの追加・変更）
  - API（エンドポイントの追加・変更）
  - その他（環境設定、インフラ、ツール）

- 実装計画（c-implementation.md）の各ステップと成果物を抽出

- 各変更内容に対応する実装ステップが存在するか確認

**チェック項目**:
- [ ] すべての画面変更に対応する実装ステップが存在する
- [ ] すべてのデータモデル変更に対応する実装ステップが存在する
- [ ] すべてのAPI変更に対応する実装ステップが存在する
- [ ] その他の変更（環境設定など）に対応する実装ステップが存在する

**検出すべき問題**:
- ❌ **Error**: タスク定義で言及された変更に対応する実装ステップがない
- ⚠️ **Warning**: 実装計画で定義されているステップがタスク定義の変更内容に含まれていない（スコープ外の作業の可能性）

#### 4.2. 成果物の具体性チェック

- 実装計画の各ステップの成果物を確認
- 成果物が具体的なファイル名・コンポーネント名で記載されているか確認

**検出すべき問題**:
- ⚠️ **Warning**: 成果物が抽象的すぎる（例: 「フォームの実装」→ 具体的なファイル名が必要）
- ⚠️ **Warning**: 成果物が記載されていないステップがある

### 5. 一貫性チェック2: タスク定義 ↔ 実装計画（ユーザーストーリーのカバレッジ）

#### 5.1. ユーザーストーリーと実装ステップの対応

- タスク定義（a-definition.md）のユーザーストーリー一覧を抽出
- 各ユーザーストーリーについて、実現するための実装ステップが存在するか確認

**チェック項目**:
- [ ] すべてのユーザーストーリーに対応する実装ステップが存在する
- [ ] ユーザーストーリーの「何をしたい（目的）」が実装で実現されている

**検出すべき問題**:
- ❌ **Error**: ユーザーストーリーに対応する実装ステップがない
- ⚠️ **Warning**: ユーザーストーリーの価値提案が実装計画で反映されていない

### 6. 一貫性チェック3: タスク定義 ↔ 実装計画（受け入れ基準の整合性）

#### 6.1. 受け入れ基準の一致確認

- タスク定義（a-definition.md）の受け入れ基準を抽出
- 実装計画（c-implementation.md）の受け入れ基準を抽出
- 両者が一致しているか確認

**チェック項目**:
- [ ] タスク定義の受け入れ基準がすべて実装計画の受け入れ基準に含まれている
- [ ] 実装計画で追加された受け入れ基準がタスク定義と矛盾していない

**検出すべき問題**:
- ❌ **Error**: タスク定義の受け入れ基準が実装計画に含まれていない
- ⚠️ **Warning**: 実装計画で追加された受け入れ基準がタスク定義にない（スコープ変更の可能性）

#### 6.2. 受け入れ基準の検証可能性

- 各受け入れ基準が具体的で検証可能か確認
- 曖昧な表現（「適切に」「うまく」など）の検出

**検出すべき問題**:
- ⚠️ **Warning**: 受け入れ基準が曖昧で検証不可能（具体的な基準に修正が必要）

### 7. 一貫性チェック4: リサーチ ↔ 実装計画（技術選定の反映）

#### 7.1. 選定技術の使用確認

- リサーチ（b-research.md）の「技術選定」セクションから選定された技術・ライブラリを抽出
- 実装計画のステップでこれらの技術が使用されているか確認

**チェック項目**:
- [ ] 選定されたすべての技術が実装ステップで使用されている
- [ ] 実装ステップで使用される技術が事前にリサーチされている

**検出すべき問題**:
- ⚠️ **Warning**: 選定された技術が実装計画で使用されていない（不要な調査の可能性）
- ⚠️ **Warning**: 実装計画で新しい技術が登場しているがリサーチされていない

#### 7.2. ベストプラクティスの適用

- リサーチ（b-research.md）の「ベストプラクティス」を抽出
- 実装計画のステップでベストプラクティスが考慮されているか確認

**検出すべき問題**:
- ⚠️ **Warning**: リサーチで特定されたベストプラクティスが実装計画に反映されていない

### 8. 一貫性チェック5: リサーチ ↔ 実装計画（再利用可能なコンポーネントの活用）

#### 8.1. 既存コンポーネントの再利用確認

- リサーチ（b-research.md）の「再利用可能なコンポーネント」を抽出
- 実装計画のステップでこれらのコンポーネントが使用されているか確認

**チェック項目**:
- [ ] リサーチで特定された再利用可能なコンポーネントが実装計画で活用されている
- [ ] 車輪の再発明（既存コンポーネントがあるのに新規作成）を避けている

**検出すべき問題**:
- ⚠️ **Warning**: 既存の再利用可能なコンポーネントがあるのに新規作成している
- ⚠️ **Warning**: リサーチで特定したコンポーネントが実装計画で使用されていない

#### 8.2. 既存コードパターンの踏襲

- リサーチ（b-research.md）の「既存コードの調査」で特定された実装パターンを抽出
- 実装計画で同じパターンを踏襲しているか確認

**検出すべき問題**:
- ⚠️ **Warning**: プロジェクトの既存パターンと異なる実装方法を採用している（一貫性の欠如）

### 9. 一貫性チェック6: リサーチ ↔ 実装計画（技術的リスクの軽減）

#### 9.1. リスク軽減策の実装確認

- リサーチ（b-research.md）の「技術的リスクと制約」を抽出
- 各リスクの軽減策が実装計画に含まれているか確認

**チェック項目**:
- [ ] すべての高優先度リスクの軽減策が実装計画に含まれている
- [ ] 中優先度リスクの軽減策が考慮されている

**検出すべき問題**:
- ❌ **Error**: 高優先度の技術的リスクの軽減策が実装計画にない
- ⚠️ **Warning**: 中優先度のリスク軽減策が実装計画にない

#### 9.2. リスクへの対処ステップの明示

- リスク軽減のための具体的な実装ステップが存在するか確認

**検出すべき問題**:
- ⚠️ **Warning**: リスク軽減策が抽象的で、具体的な実装ステップがない

### 10. 一貫性チェック7: 実装計画の完全性

#### 10.1. フェーズ分割の妥当性

- フェーズが適切な粒度で分割されているか確認
- 各フェーズが独立してテスト可能か確認

**チェック項目**:
- [ ] 各フェーズの目的が明確である
- [ ] 各フェーズの完了条件が具体的である
- [ ] フェーズ間の依存関係が明確である

**検出すべき問題**:
- ⚠️ **Warning**: フェーズが大きすぎる（1フェーズが1週間以上）
- ⚠️ **Warning**: フェーズの完了条件が曖昧

#### 10.2. ステップの粒度と順序

- ステップが適切な粒度（1-3時間）で分割されているか確認
- ステップの順序が依存関係を考慮しているか確認

**検出すべき問題**:
- ⚠️ **Warning**: ステップが大きすぎる（1日以上かかる）
- ⚠️ **Warning**: 依存関係が逆転している（例: テストを書く前にコードを実装していない）

#### 10.3. テスト計画の包括性

- テストフェーズが含まれているか確認
- ユニットテスト、統合テスト、E2Eテストが計画されているか確認

**検出すべき問題**:
- ❌ **Error**: テストフェーズが存在しない
- ⚠️ **Warning**: ユニットテストのみでE2Eテストがない
- ⚠️ **Warning**: エッジケーステストが計画されていない

### 11. 一貫性チェック8: タスク全体の実現可能性

#### 11.1. タスクの目的との整合性

- タスク定義（a-definition.md）の「解決する問題」と「提供する価値」を確認
- 実装計画がその目的を達成できる内容か確認

**検出すべき問題**:
- ❌ **Error**: 実装計画がタスクの目的を達成できない（根本的な見直しが必要）

#### 11.2. スコープの適切性

- タスクのスコープが適切か確認（大きすぎないか、小さすぎないか）
- 1タスクが1-2週間程度で完了できる規模か確認

**検出すべき問題**:
- ⚠️ **Warning**: タスクが大きすぎる（複数タスクに分割を推奨）
- ⚠️ **Warning**: タスクが小さすぎる（他タスクとマージを推奨）

#### 11.3. 依存関係の明示

- 他タスクへの依存関係が明示されているか確認
- 前提条件が満たされているか確認

**検出すべき問題**:
- ⚠️ **Warning**: 他タスクへの依存関係が明示されていない

### 12. レビュー結果レポートの作成

- 検出されたすべての問題をカテゴリ別に整理：

```markdown
# タスクドキュメント一貫性レビュー結果

**レビュー実施日**: [日付]
**タスクID**: task{id}-{スラッグ}

## サマリー

- ✅ OK: X項目
- ⚠️ Warning: X項目
- ❌ Error: X項目

**総合評価**: [優/良/可/不可]

## 修正が必要な項目

### 優先度: High（修正必須）

#### 1. [問題のタイトル]
- **カテゴリ**: タスク定義 ↔ 実装計画（変更内容のカバレッジ）
- **詳細**: [具体的な問題の説明]
- **影響**: [この問題が放置された場合の影響]
- **修正提案**: [具体的な修正方法]
- **関連ドキュメント**:
  - `docs/tasks/task{id}-{スラッグ}/a-definition.md`
  - `docs/tasks/task{id}-{スラッグ}/c-implementation.md`

### 優先度: Medium（改善推奨）

### 優先度: Low（任意）

## チェック項目別の詳細

### 1. タスク定義 ↔ 実装計画（変更内容のカバレッジ）
- 画面変更カバレッジ: X / Y (XX%)
- データモデル変更カバレッジ: X / Y (XX%)
- API変更カバレッジ: X / Y (XX%)
- 検出された問題: X件

### 2. タスク定義 ↔ 実装計画（ユーザーストーリーのカバレッジ）
- ユーザーストーリーカバレッジ: X / Y (XX%)
- 検出された問題: X件

### 3. タスク定義 ↔ 実装計画（受け入れ基準の整合性）
- 受け入れ基準一致率: X / Y (XX%)
- 検証可能性: [評価]
- 検出された問題: X件

### 4. リサーチ ↔ 実装計画（技術選定の反映）
- 選定技術の使用率: X / Y (XX%)
- ベストプラクティス適用率: [評価]
- 検出された問題: X件

### 5. リサーチ ↔ 実装計画（再利用可能なコンポーネントの活用）
- コンポーネント再利用率: X / Y (XX%)
- 既存パターン踏襲度: [評価]
- 検出された問題: X件

### 6. リサーチ ↔ 実装計画（技術的リスクの軽減）
- リスク軽減策カバレッジ: X / Y (XX%)
- 検出された問題: X件

### 7. 実装計画の完全性
- フェーズ分割妥当性: [評価]
- ステップ粒度: [評価]
- テスト計画包括性: [評価]
- 検出された問題: X件

### 8. タスク全体の実現可能性
- 目的との整合性: [評価]
- スコープの適切性: [評価]
- 依存関係の明示: [評価]
- 検出された問題: X件

## 次のアクション

1. [最優先で修正すべき項目]
2. [次に修正すべき項目]
3. [余裕があれば修正する項目]

## レビュー所見

### 強み
[このタスクドキュメントの優れている点]

### 改善点
[改善すべき点、懸念事項]

### 推奨事項
[実装開始前に対応すべき事項]

## 備考

[追加のコメント、質問事項など]
```

### 13. レビュー結果の保存

- レビュー結果を `docs/tasks/task{id}-{スラッグ}/TASK-REVIEW-REPORT.md` として保存

- ユーザーに結果を報告：
  - 「タスクレビューが完了しました。」
  - Error件数、Warning件数を表示
  - 総合評価を表示
  - 「詳細は `docs/tasks/task{id}-{スラッグ}/TASK-REVIEW-REPORT.md` を参照してください。」

### 14. 修正ガイダンス

- 検出された問題について、修正方法を提案：
  - Errorが検出された場合：「以下の問題を優先的に修正してください：」
  - 修正すべきドキュメントとワークフローを案内：
    - 例：「ユーザーストーリーUS-002に対応する実装ステップがありません → `/b-003-CreateTaskImplementation` で実装計画を更新」
    - 例：「受け入れ基準が一致していません → `/b-001-CreateTaskDefinition` でタスク定義を見直し」

- ユーザーに確認：「今すぐ修正作業を開始しますか？それとも後で個別に修正しますか？」

### 15. 実装開始可否の判定

**総合評価の基準**:
- **優（実装開始OK）**: Error 0件、Warning 3件以下
- **良（軽微な修正後に実装開始）**: Error 0件、Warning 4-10件
- **可（修正後に実装開始）**: Error 1-3件、または Warning 11件以上
- **不可（大幅な見直しが必要）**: Error 4件以上

**推奨アクション**:
- 総合評価が「優」「良」の場合：「実装開始可能です。`/c-001-ImplementTask` を実行してください。」
- 総合評価が「可」の場合：「Error を修正後、実装を開始してください。」
- 総合評価が「不可」の場合：「タスクドキュメント全体の見直しが必要です。チームでレビュー会議を実施することを推奨します。」

## 完了条件

- すべてのチェック項目が実行されている
- タスクレビュー結果レポート（`TASK-REVIEW-REPORT.md`）が作成されている
- 検出された問題がカテゴリ別・優先度別に整理されている
- 各問題に具体的な修正提案が含まれている
- 総合評価と実装開始可否の判定が記載されている
- ユーザーにレビュー結果が報告されている

## エスカレーション

- 重大な不整合が多数検出された場合（Error 4件以上）：
  - 「重大な不整合が多数検出されました（Error: X件）。タスクドキュメント全体の見直しが必要です。」
  - 「チームレビュー会議を開催し、タスクの再定義を検討してください。」

- タスクの目的が実装計画で達成できない場合：
  - 「実装計画がタスクの目的を達成できません。」
  - 「タスクの再定義（`/b-001`）または実装計画の再作成（`/b-003`）が必要です。」

- 技術的リスクの軽減策が不足している場合：
  - 「技術的リスクの軽減策が実装計画に含まれていません（X件）。」
  - 「リスクの高い項目から順に軽減策を検討し、実装計画に追加してください。」

- テスト計画が不足している場合：
  - 「テスト計画が不足しています。」
  - 「ユニットテスト、統合テスト、E2Eテストを含む包括的なテスト計画を作成してください。」

- タスクのスコープが大きすぎる場合：
  - 「タスクのスコープが大きすぎます（フェーズ数: X、ステップ数: Y）。」
  - 「タスクを複数の小さなタスクに分割することを推奨します。」

## ベストプラクティス

- **実装開始前に必ず実行**: c-001 実行前に b-004 でレビューし、問題を早期発見
- **段階的レビュー**: b-001完了後、b-002完了後、b-003完了後の各段階で部分レビューを実施
- **チームレビュー**: 重要なタスクや大規模なタスクはチーム全体でレビュー会議を実施
- **継続的更新**: 実装中に新しい発見があれば、ドキュメントを更新し、再レビュー
- **メトリクス記録**: レビュー結果（Error数、Warning数）を記録し、タスク品質を追跡
- **フィードバックループ**: レビュー結果を基にテンプレートや次のタスクを改善

## 参考: レビュー対象ドキュメント構造

**a-definition.md（タスク定義）**:
- 目的（解決する問題、提供する価値）
- ユーザーストーリー一覧
- 変更内容一覧（画面、データモデル、API、その他）
- 受け入れ基準

**b-research.md（リサーチ）**:
- ベストプラクティス
- 既存コードの調査
- 再利用可能なコンポーネント
- 技術選定
- 技術的リスクと制約

**c-implementation.md（実装計画）**:
- フェーズ（目的、完了条件）
- ステップ（成果物、詳細）
- 受け入れ基準

## 参考: タスクライフサイクルにおける位置づけ

```
b-000: タスクディレクトリ作成
  ↓
b-001: タスク定義作成
  ↓
b-002: リサーチ実施
  ↓
b-003: 実装計画作成
  ↓
b-004: タスクレビュー ← このワークフロー
  ↓
c-001: 実装実行
  ↓
c-002: ドキュメント更新
```

b-004は実装開始前の「最後の砦」として、タスクの品質と実現可能性を保証する重要な役割を果たします。
