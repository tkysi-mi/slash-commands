# /dev-6-commit-message

## 目的

- 変更内容と意図を短時間で把握し、リポジトリ規約に沿ったコミットメッセージを作成する。
- 追加検証情報（テスト結果、チケット番号など）を漏れなく記載し、レビュー効率を高める。

## 前提

- 作業ディレクトリで`git status`/`git diff`を実行できる。
- リポジトリのコミット規約（例: Conventional Commits）がREADMEやドキュメントで共有されている。
- Windsurfの`code_search`/`read_file`/`run_command`/`update_plan`が利用可能である。

## 手順

### プラン作成（Create Plans）

1. 規約と既存履歴の確認

   - `code_search`や`read_file`でコミットポリシー（例: CONTRIBUTING.md）を探す。
   - `run_command`で直近のコミットログを参照し、トーンやフォーマットを確認する。

2. 変更内容の棚卸し

   - `run_command`で`git status --short`を実行し、変更ファイルとステージ状態を把握する。
   - 必要に応じて`git diff --staged`/`git diff`を取得し、主要な変更点・目的・影響範囲をメモする。
   - 変更の背景や関連チケットが未整理の場合は`update_plan`でTODO化し、Storyに追記する。

### システム設計（System Design）

1. メッセージ骨子の設計

   - 変更タイプ（feat/fix/docs/choreなど）とスコープ（モジュール、パッケージ名）を決定する。
   - 概要（What）、理由（Why）、テスト/検証結果（How）を箇条書きで整理する。

2. 補足情報の確認

   - 関連チケット番号、Story ID、フォローアップタスクの有無を確認し、必要に応じてリンクや参照を控える。
   - ブレイキングチェンジがある場合は明確な説明を準備する。

### タスク実行（Task Execution）

1. メッセージ下書き

   - テンプレート例:
     - `type(scope): short summary`
     - 空行
     - `- what changed`
     - `- why it changed`
     - `- tests: <command/results>`
   - 文字数上限（72文字程度）を意識して件名を作成する。

2. 検証と調整

   - `run_command`で`git diff --staged`を再確認し、メッセージに漏れがないかチェックする。
   - 件名/本文で受動語を避け、具体的な名詞・動詞を用いる。
   - ブレイキングチェンジ、フォローアップ予定、Co-authored-byがあれば本文末に追記する。

3. 入力と共有

   - 作成したメッセージを`git commit`コマンドに適用する。
   - Story/PRにコミット概要とテスト結果を貼り付け、レビューの準備を整える。

## 完了条件

- コミット件名・本文がリポジトリ規約を満たし、変更の目的と影響が明確になっている。
- 必要な付随情報（チケット、テスト結果、ブレイキングチェンジ）が本文に記載されている。
- StoryやPRにコミットメッセージが共有され、次のワークフロー（例: `/dev-7-swarm-qa`）に引き渡せる状態である。

## エスカレーション

- コミット規約が不明、または複数案が対立する場合はリポジトリメンテナやテックリードに確認する。
- 変更意図が整理できない、もしくはメッセージ化できない場合はStoryやドキュメントを再精査し、必要なら再設計を依頼する。
