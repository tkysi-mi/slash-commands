# /dev-2-planning

## 目的

- 開発着手前にPRDとアーキテクチャ方針を整備し、ストーリーファイルへ渡す設計情報を欠落なく揃える。
- BMad Methodの多層エージェント計画とClaude-Flowのスキル活用を組み合わせ、再現性の高い計画プロセスを維持する。

## 前提

- このワークフロー単体で実行するために、必要情報をWindsurfの`code_search`/`read_file`で取得できる権限があること。
- プロジェクトのREADMEや関連仕様が最新であり、依頼元からゴール・制約・優先度が共有済みであること。
- Cascadeが@slash-commands-best-practices.mdで定義された命名規約・文字数管理・権限ポリシーに従うこと。
- 後続工程のワークフローが存在しない場合でも、手順6で定義するフォールバック指示に従い手動移管できること。

## 手順

### プラン作成（Create Plans）

1. 依頼内容の収集と整合

   - 依頼チケット・既存ドキュメント・口頭合意を`code_search`や`read_file`で確認し、目的・非目的・デッドライン・成功指標を整理する。
   - 不明点や競合情報があれば即座に依頼元へ質問し、暫定判断を避ける。

2. ステークホルダー合意の取得

   - 依頼元とドラフトをレビューし、期待値・完了条件・優先度・モニタリング要件を揃える。
   - 合意内容をPRD案やメモに反映し、`update_plan`で残タスクを管理する。

### システム設計（System Design）

1. 設計テンプレートの構築

   - BMad MethodのAnalyst/PM/Architectの役割に沿い、以下を用意する。テンプレートがなければ`Call /create-workflow`で雛形を生成する。
     - **PRD**（課題・ユーザーストーリー・非機能要件・受入基準）
     - **アーキテクチャ**（構成図・影響範囲・依存モジュール・データ契約）
     - **リスクログ**（制約・外部要因・回避策）
   - 既存資産と差分比較し、重複ドキュメントを統合する。

2. コンテキスト整理と参照設計

   - 長文資料は`@docs/...`形式で参照し、PRD/設計書には要約のみ記載する。
   - Claude-Flowのハイブリッドメモリを意識し、重要キーワードや識別子を明確にラベル付けする。

3. 役割連携の設計

   - 役割ごとのアウトプットとバトンパス（Analyst → PM → Architect → Scrum Masterなど）を定義する。
   - Storyファイルへ渡す必須フィールド（目的、依存、テスト観点、エラーハンドリング方針、使用MCPツール）を箇条書きでまとめる。

### タスク化とハンドオーバー（Task Authoring）

1. 設計成果物の確定と保存

   - PRD/設計書/リスクログをリポジトリに保存し、変更履歴を残す。
   - 将来の改善ポイントや未解決事項は`update_plan`でTODO化する。

2. 実装チームへの受け渡し

   - 後続ワークフロー（例: `/dev-5-implementation`）がある場合は、起動トリガー・入力ファイルパス・担当者を明記する。
   - 後続ワークフローが存在しない場合は、手動移管用チェックリストとStoryファイル雛形を作成し、共有チャネルを明示する。

## 完了条件

- PRDとアーキテクチャドキュメントが最新化され、依頼元と合意済みである。
- Storyファイルの入力テンプレートが用意され、後続ワークフローの開始条件が明文化されている。
- リスクログ・参照リンク・依存関係が整理され、レビュー履歴が残っている。

## エスカレーション

- 仕様が固定できない場合、依頼元またはプロダクトオーナーに決裁を依頼し計画フェーズを保留する。
- 既存アーキテクチャと競合する変更が必要な場合は、アーキテクトまたはガバナンス委員会にエスカレーションする。
