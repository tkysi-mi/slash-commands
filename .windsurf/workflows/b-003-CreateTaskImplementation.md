---
description: タスクの実装計画を段階的に分割し、ステップごとの成果物と受け入れ基準を定義するワークフロー
auto_execution_mode: 1
---

# /b-003-CreateTaskImplementation

## 目的

- タスクの実装作業を段階的に分割して管理しやすくする。
- フェーズごとに完了条件を明確化し、進捗を可視化する。
- 各ステップの成果物を具体的に定義し、実装漏れを防止する。
- 受け入れ基準を事前に定義し、テスト・品質保証の基準を明確にする。
- チーム内で実装計画を共有し、レビューしやすくする。

## 前提

- タスクディレクトリが既に作成されていること（`/b-000-CreateTaskDirectory` で作成済み）
- タスク定義ドキュメント（`a-definition.md`）が作成されていること（`/b-001-CreateTaskDefinition` で作成済み）
- リサーチドキュメント（`b-research.md`）が作成されていること（`/b-002-CreateTaskResearch` で作成済み）
- タスクディレクトリ形式: `docs/tasks/task000001-{スラッグ}/`
- タスクディレクトリ内に `c-implementation.md` テンプレートが存在すること

## 手順

### 1. タスク定義とリサーチの確認

#### 1.1. タスクディレクトリの確認

**質問1: タスクディレクトリの確認**
- 「タスクディレクトリのパスを教えてください。」
- 例: `docs/tasks/task000001-email-verification/`

#### 1.2. タスク定義ドキュメントの読み込み

- タスクディレクトリ内の `a-definition.md` を読み込む
- 確認すべき内容:
  - **目的**: 解決する問題、提供する価値
  - **ユーザーストーリー**: 実装すべき機能
  - **変更内容**: 画面、データモデル、API、ビジネスロジック、インフラ
  - **受け入れ基準**: 正常系、異常系、エッジケース、テスト、パフォーマンス、セキュリティ

#### 1.3. リサーチドキュメントの読み込み

- タスクディレクトリ内の `b-research.md` を読み込む
- 確認すべき内容:
  - **ベストプラクティス**: 推奨される実装パターン
  - **既存コードの調査**: 参考にすべき実装
  - **再利用可能なコンポーネント**: 使用する共通コンポーネント
  - **技術選定**: 導入する技術・ライブラリ
  - **技術的リスクと制約**: 考慮すべきリスクと軽減策

### 2. フェーズ分割の決定

#### 2.1. フェーズ分割の方針

**質問2: フェーズ分割の方針**
- 「実装をどのようにフェーズ分割しますか？」

**フェーズ分割のパターン**:

**A. 機能単位で分割**
- 適用場面: 機能が独立している場合
- 例:
  - フェーズ 1: データモデルと API の実装
  - フェーズ 2: フロントエンド UI の実装
  - フェーズ 3: 統合とテスト

**B. 依存関係で分割**
- 適用場面: 機能に依存関係がある場合
- 例:
  - フェーズ 1: データベーススキーマとマイグレーション
  - フェーズ 2: バックエンド API の実装
  - フェーズ 3: フロントエンド UI の実装
  - フェーズ 4: E2E テストと統合

**C. リスクで分割**
- 適用場面: 技術的リスクがある場合
- 例:
  - フェーズ 1: 技術検証（プロトタイプ、PoC）
  - フェーズ 2: 本実装
  - フェーズ 3: パフォーマンス最適化
  - フェーズ 4: セキュリティ強化とテスト

**ベストプラクティス**:
- 1フェーズは **1-3日以内**で完了できる粒度
- フェーズごとに **動作確認可能な状態**にする
- 各フェーズで **小さくコミット・PR を作成**（レビュー負荷軽減）

#### 2.2. フェーズ数の決定

**質問3: フェーズ数**
- 「いくつのフェーズに分割しますか？」
- 推奨: 2〜4フェーズ（多すぎると管理が複雑になる）

例：
- 小規模タスク（1〜3日）: 2フェーズ
- 中規模タスク（4〜7日）: 3フェーズ
- 大規模タスク（8〜14日）: 4フェーズ

### 3. 各フェーズの詳細定義

各フェーズについて、以下を定義します。

#### 3.1. フェーズ名と目的

**質問4: フェーズ {N} の名前**
- 「フェーズ {N} の名前を決めてください。」
- 例: 「データモデルと API の実装」「フロントエンド UI の実装」

**質問5: フェーズ {N} の目的**
- 「フェーズ {N} の目的は何ですか？」
- 簡潔に1〜2文で記載

例：
- 「データベーススキーマを定義し、API エンドポイントを実装する」
- 「ユーザー登録フォームとメール認証ページを作成し、フロントエンドを完成させる」

#### 3.2. フェーズの完了条件

**質問6: フェーズ {N} の完了条件**
- 「フェーズ {N} が完了したと判断する基準は何ですか？」

例：
- 「API が期待通りのレスポンスを返し、ユニットテストが全て通る」
- 「ユーザー登録から認証完了までの一連の流れが動作し、E2E テストが通る」
- 「テストカバレッジが80%以上で、ドキュメントが更新されている」

#### 3.3. ステップの定義

**質問7: フェーズ {N} のステップ**
- 「フェーズ {N} を完了するために必要なステップは何ですか？」

**ステップの粒度**:
- 1ステップは **1-3時間程度**で完了できる作業
- **コミット単位**で分割すると管理しやすい
- 成果物が明確であること（ファイル、機能、テスト）

**記載のポイント**:
- **具体的なファイル名やコンポーネント名**を含める
- 実装の詳細には**アルゴリズムや技術的な注意点**を記載
- 依存関係があるステップは**順序を意識**

各ステップについて、以下をヒアリング：

**質問8: ステップ {N} の内容**
- 「ステップ {N} では何をしますか？」

**質問9: ステップ {N} の成果物**
- 「ステップ {N} の成果物は何ですか？」
- 具体的なファイル名を含める

例：
- `migrations/001_create_users_table.sql`
- `src/types/User.ts`
- `src/api/auth/send-verification.ts`
- `src/pages/EmailVerificationPage.tsx`

**質問10: ステップ {N} の詳細**
- 「ステップ {N} の実装の詳細を教えてください。」
- 技術的な注意点、使用するライブラリ、アルゴリズムなどを記載

例：
- 「User テーブルに `email_verified`, `verification_token`, `token_expires_at` を追加。インデックスは `verification_token` に作成」
- 「トークン生成（UUID v4）、有効期限 24 時間、SendGrid API 呼び出し。エラーハンドリング実装」
- 「React Hook Form でフォーム管理、API 呼び出しは useMutation で非同期処理」

### 4. 受け入れ基準の定義

各フェーズの完了を判断するための具体的な受け入れ基準を定義します。

#### 4.1. フェーズごとの受け入れ基準

各フェーズについて、以下をヒアリング：

**質問11: フェーズ {N} の受け入れ基準**
- 「フェーズ {N} が完了したと判断する基準を列挙してください。」

**受け入れ基準の記載ポイント**:
- **機能が正しく動作すること**（正常系）
- **エラーハンドリングが適切に実装されていること**（異常系）
- **エッジケースが処理されること**（境界値、特殊な入力）
- **パフォーマンス要件を満たすこと**（必要に応じて）
- **セキュリティ要件を満たすこと**（XSS, CSRF, SQL Injection など）
- **ブラウザ互換性**（必要に応じて）
- **テストが全て通ること**
- **ドキュメントが更新されていること**

例：
- [ ] データベースマイグレーションが成功する
- [ ] 型定義が正しく適用される（TypeScript コンパイルエラーなし）
- [ ] メール送信 API がトークンを生成し、メールを送信する
- [ ] 無効なトークンでアクセスした場合、エラーが返る
- [ ] トークンの有効期限切れが正しく検出される

### 5. メモ・補足情報

**質問12: 実装全体の補足情報**
- 「実装全体に関する補足情報はありますか？」

記載すべき内容：
- 実装中に気づいた技術的な課題
- リファクタリングが必要な箇所
- パフォーマンス最適化の余地
- セキュリティ上の注意点
- 今後の拡張予定
- チームメンバーへの引き継ぎ事項

例：
- 「メール送信は現在同期処理だが、将来的にはジョブキューに移行予定」
- 「トークンの有効期限は現在 24 時間だが、設定ファイルで変更可能にする」
- 「SendGrid の API キーは環境変数で管理（.env.example に記載）」
- 「セキュリティレビュー完了（2025-01-15、レビュアー: @john）」

### 6. ドキュメント作成

- 収集した情報を基に、タスクディレクトリ内の `c-implementation.md` を編集
- 例: `docs/tasks/task000001-email-verification/c-implementation.md`

- テンプレートに従い、以下を記載：
  - **各フェーズ**（フェーズ名、目的、完了条件、ステップ一覧）
  - **ステップ**（ステップ名、成果物、詳細）
  - **受け入れ基準**（フェーズごとの受け入れ基準）
  - **メモ**（補足情報）

- **HTMLコメントは削除せず残す**

### 7. レビューと確認

- 作成したドキュメントをユーザーに提示：
  - 「実装タスクリストが完成しました。内容を確認してください。」
  - 「フェーズ分割は適切ですか？」
  - 「各ステップの成果物は明確ですか？」
  - 「受け入れ基準は具体的で測定可能ですか？」
  - 「実装の詳細は十分に記載されていますか？」

### 8. 完成と次のステップ

- タスクディレクトリ内の `c-implementation.md` が保存されたことを確認
- 例: `docs/tasks/task000001-email-verification/c-implementation.md`

- 次のステップを提案：
  - 「実装タスクリストが完了しました。これでタスクドキュメントの作成が完了しました。実装を開始する準備が整いました。」
  - 「実装を開始しますか？それともドキュメントをレビューしますか？」

## 完了条件

- タスクディレクトリ内に `c-implementation.md` が作成されている
- 例: `docs/tasks/task000001-{スラッグ}/c-implementation.md`
- 以下のセクションがすべて記載されている：
  - フェーズ（最低2個以上）
  - 各フェーズの目的と完了条件
  - 各フェーズのステップ（最低1個以上）
  - 各ステップの成果物と詳細
  - 受け入れ基準（各フェーズごと）
- フェーズが適切な粒度（1-3日以内で完了可能）に分割されている
- ステップの成果物が具体的なファイル名を含んでいる
- 受け入れ基準が具体的で測定可能である
- ユーザーが内容を確認し、承認している

## エスカレーション

- タスク定義やリサーチが完了していない場合：
  - 「タスク定義（`a-definition.md`）またはリサーチ（`b-research.md`）が完了していません。先に `/b-001-CreateTaskDefinition` と `/b-002-CreateTaskResearch` を実行してください。」

- フェーズ分割が不適切な場合：
  - 「フェーズの粒度が大きすぎます（または小さすぎます）。1フェーズは1-3日以内で完了できる粒度が理想です。」
  - フェーズの再分割を提案

- ステップの粒度が大きすぎる場合：
  - 「ステップの粒度が大きすぎます。1ステップは1-3時間程度で完了できる粒度に分割してください。」
  - 「例: 「API の実装」→「トークン生成」「メール送信」「エラーハンドリング」に分割」

- ステップの成果物が不明確な場合：
  - 「ステップの成果物が抽象的すぎます。具体的なファイル名やコンポーネント名を含めてください。」
  - 「例: 「フォーム作成」→「`src/features/auth/RegisterForm.tsx` を作成」」

- 受け入れ基準が曖昧な場合：
  - 「受け入れ基準が曖昧です。テスト可能な基準を定義してください。」
  - 「例: 「使いやすい」→「登録完了まで3クリック以内」」
  - 「例: 「速い」→「API レスポンスタイムが200ms以内」」

- 受け入れ基準にセキュリティ要件が欠けている場合：
  - 「セキュリティに関する受け入れ基準が不足しています。以下を検討してください：」
    - 入力バリデーション
    - XSS、CSRF、SQL Injection 対策
    - 認証・認可
    - データの暗号化
    - API のレート制限

- 受け入れ基準にテスト要件が欠けている場合：
  - 「テストに関する受け入れ基準が不足しています。以下を検討してください：」
    - ユニットテスト
    - 統合テスト
    - E2E テスト
    - テストカバレッジ

- フェーズ間の依存関係が不明確な場合：
  - 「フェーズ間の依存関係が不明確です。フェーズ {N} はフェーズ {N-1} の完了後に開始すべきですか？」
  - 依存関係を明示するよう提案

## 参考：実装タスクリストの例

### フェーズ 1: データモデルと API の実装

**目的:** データベーススキーマを定義し、API エンドポイントを実装する

**完了条件:** API が期待通りのレスポンスを返し、ユニットテストが全て通る

**ステップ:**
- [ ] **ステップ 1:** データベーススキーマの定義
  - **成果物:** `migrations/001_create_users_table.sql`
  - **詳細:** User テーブルに `email_verified`, `verification_token`, `token_expires_at` を追加。インデックスは `verification_token` に作成

- [ ] **ステップ 2:** TypeScript 型定義の追加
  - **成果物:** `src/types/User.ts`
  - **詳細:** `User` インターフェースに新しいフィールドを追加。Zod スキーマも同時に定義

- [ ] **ステップ 3:** メール送信 API エンドポイントの実装
  - **成果物:** `src/api/auth/send-verification.ts`
  - **詳細:** トークン生成（UUID v4）、有効期限 24 時間、SendGrid API 呼び出し。エラーハンドリング実装

**受け入れ基準:**
- [ ] データベースマイグレーションが成功する
- [ ] 型定義が正しく適用される（TypeScript コンパイルエラーなし）
- [ ] メール送信 API がトークンを生成し、メールを送信する
- [ ] 無効なトークンでアクセスした場合、エラーが返る
