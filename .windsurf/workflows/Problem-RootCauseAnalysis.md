---
description: インシデントやバグ報告の再現から証拠収集、仮説検証、根本原因の特定、対策提案、レポート共有までを体系的に進める調査ワークフロー
auto_execution_mode: 1
---

# /root-cause-analysis

## 目的

- バグ報告や予期せぬ挙動の根本原因を特定し、再発防止策まで導き出す。
- 実装担当・QA・SREなど関係者と共有できる調査ログを残し、学習サイクルを回す。

## 前提

- 調査対象の現象が再現条件・発生環境とともに共有されていること。
- 必要なログ閲覧権限や監視ダッシュボードへのアクセスが許可されていること。
- セキュリティ／個人情報を含むデータを扱う場合は、組織のルールに沿ってマスキング・持ち出し制限を守ること。

## 手順

1. **インシデント概要の整理**
   - 依頼メッセージ・チケット・アラート内容から「何が」「いつ」「どこで」発生したかを要約する。
   - 影響範囲（ユーザー数・機能・SLA）と緊急度を明確化し、必要に応じてエスカレーションルールを確認する。

2. **現象の再現可否を確認**
   - 再現手順が提示されていなければ依頼元へ質問して補完する。
   - 再現環境（本番 / ステージング / ローカル）を決定し、安全に検証できる範囲を確保する。

3. **観測データの収集**
   - ログ、メトリクス、トレース、アラート履歴など使える証拠を列挙し、優先度順に取得する。
   - 時系列（発生前→直後→平常時）で比較できるようメモを残す。
   - `run_command` や MCP (ログ閲覧ツール等) を使う際は、実行目的と安全性を確認してから操作する。

4. **仮説の構築と検証計画**
   - 観測した事実から原因候補を3〜5個程度洗い出し、「もし○○が原因なら△△が起きるはず」と期待結果を定義する。
   - 検証順序を決め、必要なら performance-engineer や security-engineer など他エージェントの支援を計画する。

5. **検証の実施**
   - 仮説ごとにログ再確認・設定差分照合・リクエスト追跡などの検証アクションを行う。
   - 各検証結果を「仮説 / 期待結果 / 実際の結果 / 判定」で記録し、却下した仮説も残す。

6. **根本原因の特定と影響分析**
   - 最も整合する仮説に対し、なぜ起きたかをシーケンス図や因果関係で説明できるレベルまで掘り下げる。
   - 影響したコンポーネント・依存サービス・再発条件を整理し、関連チームへの共有事項を抽出する。

7. **恒久対応と暫定対応の提案**
   - 恒久対策（コード修正・設定変更・設計見直しなど）と暫定的な緩和策（リトライ増加・スロットリング等）を分けて提示する。
   - 必要なタスク、担当、期限、テスト指標を簡潔にまとめる。

8. **レポート化とフォローアップ**
   - 事象概要 / タイムライン / 根本原因 / 対策 / 教訓 を含む報告テンプレートを埋め、依頼元に共有する。
   - 再発防止のためにドキュメント更新やモニタリング強化が必要なら提案する。
   - 未解決のフォローアップがある場合はTODOとして明示する。

## 完了条件

- 根本原因が証拠付きで説明され、影響範囲と再発条件が整理されている。
- 恒久対策と暫定対策、必要なフォローアップタスクが明文化されている。
- 調査ログ（仮説と検証結果）が共有済みで、関係者が次のアクションに移れる状態になっている。

## エスカレーション

- 高優先度インシデント（SLA違反の恐れ、広範囲障害）の場合は即座にインシデントコマンダー／SREへ通知する。
- 権限が必要なログや本番操作が絡む場合は、アクセス権限者に連絡し自律的に実行しない。
- 調査が24時間以上停滞する、または仮説が立てられない場合は、チームリードに状況共有し追加リソースを依頼する。
