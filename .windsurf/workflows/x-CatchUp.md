---
description: 仕様と既存実装を照らし合わせてギャップ・リスク・依存関係を把握し、実行可能な分析結果をまとめるワークフロー
auto_execution_mode: 1
---

# /speckit.analyze

## 目的

- 最新の仕様・要求・ユーザーストーリーを整理し、現行実装とのギャップを可視化する。
- 依存関係・リスク・制約を分析し、計画段階で必要な前提条件やブロッカーを特定する。
- 具体的な改善提案やフォローアップタスクを提示し、次フェーズ（設計・実装・計画）の意思決定を支援する。

## 前提

- 対象プロジェクトの仕様書、ユーザーストーリー、テクニカルドキュメント、コードリポジトリへアクセスできること。
- リポジトリの README やガイドライン、関連するワークフローが最新化されていること。
- 分析結果を共有するチャンネル（Issue, PR, Wiki 等）とレビュー担当者が明確であること。
- 機密情報を扱う場合は、アクセス権限や情報共有の範囲について組織ポリシーを遵守する。

## 手順

1. **コンテキスト同期**
   - 依頼内容、最近の仕様変更、関連 Issue/PR、設計ドキュメントを収集し、背景と目的を要約する。
   - `run_command` や Repo Index MCP を使って関連ファイル・モジュールの一覧を取得し、分析対象のスコープを確定する。

2. **仕様・要求キュレーション**
   - ユーザーストーリー、ユースケース、機能要件・非機能要件を整理し、優先度や依存関係を明記する。
   - 明文化されていない前提（対象ユーザー、データフロー、法的制約など）がないかチェックし、暫定仮定として記録する。

3. **現行実装レビュー**
   - 対象領域のコード構造、データモデル、テストカバレッジを確認し、仕様との整合性を評価する。
   - `run_command` で静的解析（Ruff / ESLint 等）やテストを実行し、品質指標・警告・脆弱性を収集する。
   - UI/UX の確認が必要な場合は Playwright MCP または Chrome DevTools MCP で現状の挙動を記録する。

4. **ギャップ＆リスク分析**
   - 仕様 vs 実装の差分、曖昧な仕様、技術的負債、依存サービスの制約をリスト化する。
   - 影響度（High/Medium/Low）と発生確率、回避策・緩和策を併記し、対応優先度を整理する。

5. **データ・イベント・UX 観点の整理**
   - 入出力データ、API 契約、イベントハンドリング、UI フローなど観点別に確認し、抜け漏れを洗い出す。
   - ドメインイベントや KPI 計測の要否を評価し、必要な計測項目や監視設定を提案する。

6. **改善提案とフォローアップ計画**
   - 明らかになった課題に対して、推奨アクション（仕様補強、リファクタリング、追加テストなど）を記述する。
   - 未解決の質問や意思決定事項をまとめ、回答期限とオーナーを設定する。
   - 後続フェーズのために `/speckit.plan` や `/speckit.tasks` に渡すべき入力（前提・制約・リスク）を整理する。

7. **サマリー共有**
   - 背景・分析結果・推奨策・未決事項を 1 ページ程度にまとめ、合意形成用のドキュメントとして共有する。
   - 合意が必要なポイントはチェックリスト化し、レビュー／承認手順を明確にする。

## 完了条件

- 仕様と実装の差分、リスク、未解決事項が整理され、優先度とオーナーが設定されている。
- 改善提案とフォローアップタスクが明文化され、次フェーズで利用可能な状態になっている。
- 分析サマリーが関係者に共有され、承認フローや回答期限が確立されている。

## エスカレーション

- 重大な仕様ギャップやリスクが発覚し、スケジュール影響が大きい場合はプロダクトオーナー／マネージャーへ即時報告する。
- セキュリティ・法務・プライバシー要件が不明瞭な場合は、専門チームへ照会し自己判断で進めない。
- コミュニケーションが停滞して分析が進行しないときは、チームリードへ状況共有し、回答者の再アサインや意思決定会議を依頼する。