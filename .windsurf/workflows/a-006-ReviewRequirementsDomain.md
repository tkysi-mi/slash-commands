---
description: 要件定義からドメインモデルまでのドキュメント間の一貫性をチェックし、不整合や漏れを検出するレビューワークフロー
auto_execution_mode: 1
---

# /a-006-ReviewRequirementsDomain

## 目的

- ここまでに作成されたすべてのドキュメント間の一貫性を体系的にチェックする。
- ドキュメント間の不整合、漏れ、矛盾を検出し、修正提案を提供する。
- ユビキタス言語の遵守状況を確認し、用語の一貫性を保証する。
- 要件定義からドメインモデルまでのトレーサビリティを確認する。
- レビュー結果レポートを作成し、修正すべき項目を優先度付きでリストアップする。

## 前提

- 以下のドキュメントが作成されていること：
  - `docs/project/01-requirements/01-system-overview.md`
  - `docs/project/01-requirements/03-features-planned.md`
  - `docs/project/01-requirements/04-non-functional-requirements.md`
  - `docs/project/01-requirements/05-user-stories.md`
  - `docs/project/02-behavior/01-scenarios.md`
  - `docs/project/03-domain/01-domain-model.md`
  - `docs/project/03-domain/02-ubiquitous-language.md`

## 手順

### 1. ドキュメント存在確認

- 以下のドキュメントを読み込む：
  - `@docs/project/01-requirements/01-system-overview.md`
  - `@docs/project/01-requirements/02-features-implemented.md` (存在する場合)
  - `@docs/project/01-requirements/03-features-planned.md`
  - `@docs/project/01-requirements/04-non-functional-requirements.md`
  - `@docs/project/01-requirements/05-user-stories.md`
  - `@docs/project/02-behavior/01-scenarios.md`
  - `@docs/project/03-domain/01-domain-model.md`
  - `@docs/project/03-domain/02-ubiquitous-language.md`

- 不足しているドキュメントがある場合：
  - 「以下のドキュメントが見つかりません：[リスト]」
  - 「先に該当するワークフローを実行してください。」
  - レビューは実行可能な範囲で継続

### 2. レビュー項目の初期化

- レビュー結果を記録するための構造を準備：
  ```
  レビュー結果:
  - OK: 問題なし
  - Warning: 要確認（重大ではないが改善推奨）
  - Error: 修正必須（不整合や重大な漏れ）
  ```

### 3. 一貫性チェック1: ユーザーストーリー ↔ シナリオ

#### 3.1. カバレッジチェック

- ユーザーストーリー一覧を抽出
- 各ユーザーストーリーについて、対応するシナリオが存在するか確認：
  - ストーリーIDとシナリオの機能名/説明を照合
  - ストーリーの「As a / I want / So that」とシナリオのFeature説明を比較

**チェック項目**:
- [ ] すべてのユーザーストーリーに対応するシナリオが存在する
- [ ] 高優先度のユーザーストーリーはすべてシナリオでカバーされている
- [ ] シナリオのFeature説明がユーザーストーリーの価値（So that）と一致している

**検出すべき問題**:
- ❌ **Error**: 優先度Highのユーザーストーリーにシナリオがない
- ⚠️ **Warning**: 優先度Mediumのユーザーストーリーにシナリオがない
- ⚠️ **Warning**: ユーザーストーリーとシナリオの表現に乖離がある

#### 3.2. 受け入れ基準とシナリオの対応

- ユーザーストーリーの受け入れ基準とシナリオのThenステップを比較：
  - 受け入れ基準がシナリオのThenで検証されているか

**検出すべき問題**:
- ❌ **Error**: 受け入れ基準がシナリオで検証されていない

### 4. 一貫性チェック2: シナリオ ↔ ドメインモデル

#### 4.1. Command/Eventマッピング

- シナリオのWhenステップをコマンドとして抽出
- シナリオのThenステップをイベントとして抽出
- ドメインモデルのCommands/Eventsと照合

**チェック項目**:
- [ ] シナリオのWhen（アクション）がドメインモデルのCommandsに対応している
- [ ] シナリオのThen（期待結果）がドメインモデルのDomain Eventsに対応している
- [ ] シナリオのGiven（前提条件）で言及されるActorsがドメインモデルに定義されている

**検出すべき問題**:
- ❌ **Error**: シナリオで使われているCommandがドメインモデルに定義されていない
- ❌ **Error**: シナリオで使われているEventがドメインモデルに定義されていない
- ⚠️ **Warning**: シナリオで使われているActorがドメインモデルに定義されていない
- ⚠️ **Warning**: ドメインモデルのCommandがどのシナリオでも使われていない（不要な定義の可能性）

#### 4.2. Aggregateとシナリオの対応

- シナリオで操作される主要なエンティティを抽出
- ドメインモデルのAggregatesと照合

**検出すべき問題**:
- ⚠️ **Warning**: シナリオで言及されるエンティティがAggregateとして定義されていない

### 5. 一貫性チェック3: すべてのドキュメント ↔ ユビキタス言語

#### 5.1. 用語定義の完全性チェック

- ドメインモデルで使われているすべての用語を抽出：
  - Actors, Commands, Events, Policies, Aggregates, Read Models

- 各用語がユビキタス言語に定義されているか確認

**チェック項目**:
- [ ] ドメインモデルのすべてのAggregateがユビキタス言語に定義されている
- [ ] ドメインモデルのすべてのCommandがユビキタス言語に定義されている
- [ ] ドメインモデルのすべてのEventがユビキタス言語に定義されている

**検出すべき問題**:
- ❌ **Error**: ドメインモデルの重要な用語（Aggregate、Commandなど）がユビキタス言語に未定義
- ⚠️ **Warning**: シナリオで使われている用語がユビキタス言語に未定義

#### 5.2. 禁止用語の使用チェック

- ユビキタス言語の「禁止用語」一覧を抽出
- すべてのドキュメントで禁止用語が使われていないか検索：
  - システム概要
  - 機能要件
  - ユーザーストーリー
  - シナリオ
  - ドメインモデル

**検出すべき問題**:
- ❌ **Error**: 禁止用語がドメインモデルで使われている（クラス名、Command名など）
- ⚠️ **Warning**: 禁止用語が他のドキュメントで使われている

#### 5.3. 用語の一貫性チェック

- 同じ概念を指す用語が複数ある場合を検出：
  - 例：「User」と「Customer」が混在
  - 表記ゆれ（「ユーザー」と「ユーザ」）

**検出すべき問題**:
- ⚠️ **Warning**: 同じ概念に対して複数の用語が使われている可能性
- ⚠️ **Warning**: 表記ゆれが検出された

### 6. 一貫性チェック4: 機能要件 ↔ シナリオ

#### 6.1. 予定機能のカバレッジ

- `features-planned.md` から予定機能一覧を抽出
- 各機能について、対応するシナリオが存在するか確認

**チェック項目**:
- [ ] 優先度Highの予定機能すべてにシナリオが存在する
- [ ] MVP（最小限の機能）に含まれる機能すべてにシナリオが存在する

**検出すべき問題**:
- ❌ **Error**: 優先度Highの機能にシナリオがない
- ⚠️ **Warning**: 優先度Mediumの機能にシナリオがない

#### 6.2. 実装済み機能の検証

- `features-implemented.md` が存在する場合：
  - 実装済み機能にシナリオが存在するか確認
  - 既知の問題がシナリオで再現されているか確認

**検出すべき問題**:
- ⚠️ **Warning**: 実装済み機能にシナリオがない（リグレッションテストが不足）

### 7. 一貫性チェック5: システム概要・目的との整合性

#### 7.1. Core Domainと競争優位性の一致

- システム概要の「目的」を抽出
- ドメインモデルのCore Domain（戦略的分類）と照合

**チェック項目**:
- [ ] Core Domainがシステムの目的と一致している
- [ ] システムの競争優位性を生む機能がCore Domainに含まれている

**検出すべき問題**:
- ⚠️ **Warning**: Core Domainがシステムの主要な価値提案と一致していない可能性

#### 7.2. 非機能要件とドメインモデルの整合性

- 非機能要件（パフォーマンス、セキュリティなど）を確認
- ドメインモデルで考慮されているか確認：
  - セキュリティ要件がPolicyやAggregateに反映されているか
  - スケーラビリティ要件がContext分割に反映されているか

**検出すべき問題**:
- ⚠️ **Warning**: 重要な非機能要件がドメインモデルで考慮されていない可能性

### 8. レビュー結果レポートの作成

- 検出されたすべての問題をカテゴリ別に整理：

```markdown
# ドキュメント一貫性レビュー結果

**レビュー実施日**: [日付]

## サマリー

- ✅ OK: X項目
- ⚠️ Warning: X項目
- ❌ Error: X項目

## 修正が必要な項目

### 優先度: High（修正必須）

#### 1. [問題のタイトル]
- **カテゴリ**: ユーザーストーリー ↔ シナリオ
- **詳細**: [具体的な問題の説明]
- **影響**: [この問題が放置された場合の影響]
- **修正提案**: [具体的な修正方法]
- **関連ドキュメント**:
  - `docs/project/01-requirements/05-user-stories.md`
  - `docs/project/02-behavior/01-scenarios.md`

### 優先度: Medium（改善推奨）

### 優先度: Low（任意）

## チェック項目別の詳細

### 1. ユーザーストーリー ↔ シナリオ
- カバレッジ: X / Y ストーリー (XX%)
- 検出された問題: X件

### 2. シナリオ ↔ ドメインモデル
- Command対応率: X / Y (XX%)
- Event対応率: X / Y (XX%)
- 検出された問題: X件

### 3. ユビキタス言語の遵守
- 定義済み用語: X個
- 未定義用語: X個
- 禁止用語の使用: X箇所
- 検出された問題: X件

### 4. 機能要件 ↔ シナリオ
- カバレッジ（優先度High）: X / Y (XX%)
- カバレッジ（全体）: X / Y (XX%)
- 検出された問題: X件

### 5. システム目的との整合性
- Core Domain一致度: [評価]
- 検出された問題: X件

## 次のアクション

1. [最優先で修正すべき項目]
2. [次に修正すべき項目]
3. [余裕があれば修正する項目]

## 備考

[全体的な所感や追加のコメント]
```

### 9. レビュー結果の保存

- レビュー結果を `docs/project/REVIEW-REPORT.md` として保存

- ユーザーに結果を報告：
  - 「レビューが完了しました。」
  - Error件数、Warning件数を表示
  - 「詳細は `docs/project/REVIEW-REPORT.md` を参照してください。」

### 10. 修正ガイダンス

- 検出された問題について、修正方法を提案：
  - Errorが検出された場合：「以下の問題を優先的に修正してください：」
  - 修正すべきドキュメントとワークフローを案内：
    - 例：「ユーザーストーリーUS-005にシナリオがありません → `/a-003-CreateScenarios` でシナリオを追加」

- ユーザーに確認：「今すぐ修正作業を開始しますか？それとも後で個別に修正しますか？」

## 完了条件

- すべてのチェック項目が実行されている
- レビュー結果レポート（`docs/project/REVIEW-REPORT.md`）が作成されている
- 検出された問題がカテゴリ別・優先度別に整理されている
- 各問題に具体的な修正提案が含まれている
- ユーザーにレビュー結果が報告されている

## エスカレーション

- 重大な不整合が多数検出された場合：
  - 「重大な不整合が多数検出されました（Error: X件）。ドキュメント全体の見直しが必要です。」
  - 「関係者を集めてレビュー会議を開催することを推奨します。」

- ユビキタス言語の定義不足が顕著な場合：
  - 「ユビキタス言語の定義が不足しています（未定義用語: X個）。」
  - 「ドメインエキスパートと協力して、`/a-004-DefineDomainModel` を再実行してください。」

- シナリオのカバレッジが低い場合：
  - 「シナリオのカバレッジが低すぎます（XX%）。」
  - 「優先度Highの機能から順に、`/a-003-CreateScenarios` でシナリオを追加してください。」

- ドメインモデルとシナリオの乖離が大きい場合：
  - 「シナリオとドメインモデルの間に大きな乖離があります。」
  - 「Event Stormingワークショップの実施を検討してください。」
